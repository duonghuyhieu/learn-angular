<div class="game-container">
  <!-- MENU SCREEN -->
  @if (!gameStarted()) {
    <div class="menu-screen">
      <button class="back-btn" (click)="goBack()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Quay l·∫°i Menu
      </button>

      <div class="logo">
        <div class="angular-logo">A</div>
        <h1>Angular Quiz</h1>
        <p class="subtitle">√în t·∫≠p Angular qua Flashcard Game</p>
      </div>

      <div class="settings-card">
        <div class="setting-group">
          <label>Ch·ªß ƒë·ªÅ:</label>
          <select [ngModel]="selectedCategory()" (ngModelChange)="selectedCategory.set($event)">
            @for (cat of categories(); track cat) {
              <option [value]="cat">{{ getCategoryLabel(cat) }}</option>
            }
          </select>
        </div>

        <div class="setting-group">
          <label>ƒê·ªô kh√≥:</label>
          <select [ngModel]="selectedDifficulty()" (ngModelChange)="selectedDifficulty.set($event)">
            @for (diff of difficulties; track diff) {
              <option [value]="diff">{{ getDifficultyLabel(diff) }}</option>
            }
          </select>
        </div>

        <div class="setting-group">
          <label>S·ªë c√¢u h·ªèi:</label>
          <select [ngModel]="questionCount()" (ngModelChange)="questionCount.set($event)">
            <option [value]="5">5 c√¢u</option>
            <option [value]="10">10 c√¢u</option>
            <option [value]="15">15 c√¢u</option>
            <option [value]="20">20 c√¢u</option>
          </select>
        </div>

        <button class="start-btn" (click)="startGame()">
          <span>B·∫Øt ƒë·∫ßu!</span>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
        </button>
      </div>

      <div class="features">
        <div class="feature">
          <span class="icon">üìö</span>
          <span>40+ c√¢u h·ªèi</span>
        </div>
        <div class="feature">
          <span class="icon">üéØ</span>
          <span>9 ch·ªß ƒë·ªÅ</span>
        </div>
        <div class="feature">
          <span class="icon">‚ö°</span>
          <span>Angular 17+</span>
        </div>
      </div>
    </div>
  }

  <!-- GAME SCREEN -->
  @if (gameStarted() && !gameState().isFinished) {
    <div class="game-screen">
      <!-- Progress bar -->
      <div class="progress-section">
        <div class="progress-info">
          <span>C√¢u {{ gameState().currentQuestionIndex + 1 }}/{{ gameState().totalQuestions }}</span>
          <span class="score">ƒêi·ªÉm: {{ gameState().score }}</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progress()"></div>
        </div>
      </div>

      <!-- Question Card -->
      @if (currentQuestion(); as question) {
        <div class="card-container" [class.flipped]="isFlipped()">
          <div class="card">
            <!-- Front -->
            <div class="card-front">
              <div class="card-header">
                <span class="category-badge" [attr.data-category]="question.category">
                  {{ getCategoryLabel(question.category) }}
                </span>
                <span class="difficulty-badge" [attr.data-difficulty]="question.difficulty">
                  {{ getDifficultyLabel(question.difficulty) }}
                </span>
              </div>

              <h2 class="question-text">{{ question.question }}</h2>

              <div class="options">
                @for (option of question.options; track $index) {
                  <button
                    class="option-btn"
                    [class.selected]="selectedAnswer() === $index"
                    [class.correct]="showResult() && $index === question.correctAnswer"
                    [class.wrong]="showResult() && selectedAnswer() === $index && $index !== question.correctAnswer"
                    (click)="selectAnswer($index)"
                    [disabled]="showResult()"
                  >
                    <span class="option-letter">{{ ['A', 'B', 'C', 'D'][$index] }}</span>
                    <span class="option-text">{{ option }}</span>
                  </button>
                }
              </div>

              @if (!showResult()) {
                <button
                  class="submit-btn"
                  [disabled]="!canProceed()"
                  (click)="submitAnswer()"
                >
                  Ki·ªÉm tra
                </button>
              }
            </div>

            <!-- Back (Explanation) -->
            <div class="card-back">
              <div class="result-icon" [class.correct]="isCorrect()" [class.wrong]="!isCorrect()">
                @if (isCorrect()) {
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M20 6L9 17l-5-5"/>
                  </svg>
                } @else {
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M18 6L6 18M6 6l12 12"/>
                  </svg>
                }
              </div>

              <h3 class="result-text" [class.correct]="isCorrect()" [class.wrong]="!isCorrect()">
                {{ isCorrect() ? 'Ch√≠nh x√°c!' : 'Sai r·ªìi!' }}
              </h3>

              <div class="explanation">
                <h4>Gi·∫£i th√≠ch:</h4>
                <p>{{ question.explanation }}</p>
              </div>

              <button class="next-btn" (click)="nextQuestion()">
                {{ gameState().currentQuestionIndex < gameState().totalQuestions - 1 ? 'C√¢u ti·∫øp theo' : 'Xem k·∫øt qu·∫£' }}
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- RESULT SCREEN -->
  @if (gameState().isFinished) {
    <div class="result-screen">
      <div class="result-card">
        <div class="confetti">
          @for (i of [1,2,3,4,5,6,7,8,9,10]; track i) {
            <div class="confetti-piece" [style.--delay]="i * 0.1 + 's'"></div>
          }
        </div>

        <h1>K·∫øt qu·∫£</h1>

        <div class="score-circle">
          <svg viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" class="bg"/>
            <circle
              cx="50" cy="50" r="45"
              class="progress"
              [style.--progress]="(gameState().score / gameState().totalQuestions) * 283"
            />
          </svg>
          <div class="score-text">
            <span class="score-number">{{ gameState().score }}</span>
            <span class="score-total">/{{ gameState().totalQuestions }}</span>
          </div>
        </div>

        <p class="score-message">{{ getScoreMessage() }}</p>

        <div class="stats">
          <div class="stat">
            <span class="stat-value correct">{{ gameState().score }}</span>
            <span class="stat-label">ƒê√∫ng</span>
          </div>
          <div class="stat">
            <span class="stat-value wrong">{{ gameState().totalQuestions - gameState().score }}</span>
            <span class="stat-label">Sai</span>
          </div>
          <div class="stat">
            <span class="stat-value">{{ (gameState().score / gameState().totalQuestions * 100) | number:'1.0-0' }}%</span>
            <span class="stat-label">T·ªâ l·ªá</span>
          </div>
        </div>

        <button class="restart-btn" (click)="restartGame()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 4v6h6M23 20v-6h-6"/>
            <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
          </svg>
          <span>Ch∆°i l·∫°i</span>
        </button>
      </div>
    </div>
  }
</div>
